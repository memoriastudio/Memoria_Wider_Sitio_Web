---
import '../../styles/style.css';
---

<section class="bg-neutral-950 relative px-4 pb-24 pt-16">
  <div class="absolute h-64 w-64 rounded-full bg-memoria/40 blur-3xl md:h-96 md:w-96"></div>
  <div class="absolute right-20 top-20 h-[24rem] w-[24rem] rounded-full bg-memoria/60 blur-3xl">
  </div>
  <div class="absolute bottom-0 h-72 w-72 rounded-full bg-memoria/30 blur-3xl md:left-1/3"></div>

  <div class="relative mx-auto max-w-7xl">
    <div class="mb-14 text-center md:text-left">
      <h1 class="text-4xl font-bold md:text-6xl">Contact Us</h1>
      <p class="mt-3 max-w-xl">Any question or remarks? Just write us a message!</p>
    </div>

    <div
      class="relative grid grid-cols-1 gap-10 rounded-3xl border bg-primary-900/10 p-8 backdrop-blur-xl dark:border-white/10 dark:bg-white/5 md:grid-cols-3 md:p-12"
    >
      <aside class="flex flex-col justify-between md:col-span-1">
        <div>
          <h2
            class="font-poppins mb-4 text-3xl font-medium font-semibold tracking-tight sm:text-4xl"
          >
            Let's work together
          </h2>
          <p class="max-w-lg text-primary-950/70 dark:text-primary-200/70 sm:text-xl">
            We'd love to learn more about you and what we can build together.
          </p>
        </div>
        <div class="flex justify-center md:absolute md:bottom-20 md:left-32">
          <img
            src="/assets/letter_send.png"
            alt="Email sending illustration"
            class="invert dark:invert-0"
            width="260"
            height="260"
          />
        </div>

        <div class="mt-10 flex items-center justify-center gap-8 md:gap-4">
          <a
            href="https://www.facebook.com/profile.php?id=100090692651300"
            class="transition"
            target="_blank"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              class="bi bi-facebook"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"
              ></path>
            </svg>
          </a>
          <a href="https://www.instagram.com/memoriastudio_llc/" class="transition" target="_blank">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              class="bi bi-instagram"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"
              ></path>
            </svg>
          </a>
          <a
            href="https://www.linkedin.com/company/memoria-studio-llc/posts/?feedView=all"
            class="transition"
            target="_blank"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              class="bi bi-linkedin"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"
              ></path>
            </svg>
          </a>
          <a href="mailto:wider@memoriastudio.net" class="transition" target="_blank">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              class="bi bi-envelope"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"
              ></path>
            </svg>
          </a>
          <a href="https://memoriastudio.net/" class="trasition" target="_blank">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              class="bi bi-globe"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z"
              ></path>
            </svg>
          </a>
        </div>
      </aside>

      <form
        id="contact-form"
        class="grid grid-cols-1 gap-6 md:col-span-2 md:grid-cols-2"
        autocomplete="off"
      >
        <div class="group relative z-0 w-full">
          <input
            type="text"
            name="firstName"
            id="firstName"
            autocomplete="off"
            class="peer block w-full appearance-none border-0 border-b border-primary-900/20 bg-transparent px-0 py-2.5 text-sm focus:border-primary-900/60 focus:outline-none focus:ring-0 dark:border-white/20 dark:focus:border-white/60"
            placeholder=" "
          />
          <label
            for="firstName"
            class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium"
            >First Name</label
          >
          <p id="error-first-name" class="mt-2 hidden text-sm text-[#FF0000]">
            Please enter your first name.
          </p>
        </div>
        <div class="group relative z-0 w-full">
          <input
            type="text"
            name="lastName"
            id="lastName"
            autocomplete="off"
            class="peer block w-full appearance-none border-0 border-b border-primary-900/20 bg-transparent px-0 py-2.5 text-sm focus:border-primary-900/60 focus:outline-none focus:ring-0 dark:border-white/20 dark:focus:border-white/60"
            placeholder=" "
          />
          <label
            for="lastName"
            class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium"
            >Last Name</label
          >
          <p id="error-last-name" class="mt-2 hidden text-sm text-[#FF0000]">
            Please enter your last name.
          </p>
        </div>
        <div class="group relative z-0 w-full md:col-span-2">
          <input
            type="email"
            name="email"
            id="email"
            autocomplete="off"
            class="peer block w-full appearance-none border-0 border-b border-primary-900/20 bg-transparent px-0 py-2.5 text-sm focus:border-primary-900/60 focus:outline-none focus:ring-0 dark:border-white/20 dark:focus:border-white/60"
            placeholder=" "
          />
          <label
            for="email"
            class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium"
            >Email address</label
          >
          <p id="error-email" class="mt-2 hidden text-sm text-[#FF0000]">
            Please enter a valid email address.
          </p>
        </div>
        <div class="group relative z-0 w-full md:col-span-2">
          <input
            type="text"
            name="subject"
            id="subject"
            autocomplete="off"
            class="peer block w-full appearance-none border-0 border-b border-primary-900/20 bg-transparent px-0 py-2.5 text-sm focus:border-primary-900/60 focus:outline-none focus:ring-0 dark:border-white/20 dark:focus:border-white/60"
            placeholder=" "
          />
          <label
            for="subject"
            class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium"
            >Subject</label
          >
          <p id="error-subject" class="mt-2 hidden text-sm text-[#FF0000]">
            Please enter a subject.
          </p>
        </div>

        <div class="group relative z-0 w-full md:col-span-2">
          <textarea
            name="message"
            id="message"
            rows="4"
            class="dark:focus:border-white/6 peer block h-16 w-full appearance-none border-0 border-b border-primary-900/20 bg-transparent px-0 py-2.5 text-sm focus:border-primary-900/60 focus:outline-none focus:ring-0 dark:border-white/20"
            placeholder=" "></textarea>
          <label
            for="message"
            class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-sm duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:left-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium"
            >Your message</label
          >
          <p id="error-message" class="mt-2 hidden text-sm text-[#FF0000]">
            Please write a message.
          </p>
        </div>

        <div class="flex justify-end md:col-span-2">
          <button
            type="submit"
            class="flex items-center gap-2 rounded-lg bg-primary-900/10 px-6 py-2 text-sm transition hover:bg-primary-900/20 dark:bg-white/10 dark:hover:bg-white/20"
          >
            Send Message
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
              <path fill="none" d="M0 0h24v24H0z"></path>
              <path
                fill="currentColor"
                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
              ></path>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<div
  id="popup"
  class="pointer-events-none fixed inset-0 z-50 flex items-center justify-center bg-primary-950/20 opacity-0 backdrop-blur-sm transition-opacity duration-300"
>
  <div
    id="popup-content"
    class="flex max-w-xl scale-90 items-start gap-6 rounded-2xl border border-primary-100 bg-white p-10 shadow-2xl transition-transform duration-300 dark:border-primary-800 dark:bg-primary-900"
  >
    <div id="icon-success" class="hidden shrink-0">
      <svg class="text-green-500 h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>
    <div id="icon-error" class="hidden shrink-0">
      <svg class="text-red-500 h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>

    <div class="flex-1">
      <h3 id="popup-title" class="mb-2 text-2xl font-bold text-primary-950 dark:text-white"></h3>
      <p
        id="popup-message"
        class="text-lg leading-relaxed text-primary-950/70 dark:text-primary-200/70"
      >
      </p>
    </div>
  </div>
</div>

<script>
  import { actions } from 'astro:actions';

  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;
  const popup = document.getElementById('popup');
  const popupContent = document.getElementById('popup-content');
  const popupTitle = document.getElementById('popup-title');
  const popupMessage = document.getElementById('popup-message');
  const iconSuccess = document.getElementById('icon-success');
  const iconError = document.getElementById('icon-error');
  const firstNameInput = document.getElementById('firstName') as HTMLInputElement;
  const lastNameInput = document.getElementById('lastName') as HTMLInputElement;
  const emailInput = document.getElementById('email') as HTMLInputElement;
  const subjectInput = document.getElementById('subject') as HTMLInputElement;
  const messageInput = document.getElementById('message') as HTMLTextAreaElement;
  const errorFirstName = document.getElementById('error-first-name');
  const errorLastName = document.getElementById('error-last-name');
  const errorEmail = document.getElementById('error-email');
  const errorSubject = document.getElementById('error-subject');
  const errorMessage = document.getElementById('error-message');

  if (form && submitBtn && popup && popupTitle && popupMessage && iconSuccess && iconError) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resetErrors();

      let isValid = true;

      if (!firstNameInput.value.trim()) {
        showError(firstNameInput, errorFirstName);
        isValid = false;
        return;
      }

      if (!lastNameInput.value.trim()) {
        showError(lastNameInput, errorLastName);
        isValid = false;
        return;
      }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailInput.value.trim() || !emailRegex.test(emailInput.value.trim())) {
        showError(emailInput, errorEmail);
        isValid = false;
        return;
      }

      if (!messageInput.value.trim()) {
        showError(messageInput, errorMessage);
        isValid = false;
        return;
      }

      if (!isValid) {
        return;
      }

      submitBtn.disabled = true;
      const originalBtnText = submitBtn.innerText;
      submitBtn.innerText = 'Sending...';
      submitBtn.classList.add('opacity-70', 'cursor-not-allowed');

      const formData = new FormData(form);

      try {
        const { data, error } = await actions.send(formData);

        if (!error) {
          showPopup('success');
          form.reset();
        } else {
          showPopup('error', error.message);
        }
      } catch (err) {
        showPopup('error', 'Connection error. Please check your internet connection.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerText = originalBtnText;
        submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
      }
    });

    function showPopup(type: 'success' | 'error', errorMessage?: string) {
      iconSuccess!.classList.add('hidden');
      iconError!.classList.add('hidden');

      if (type === 'success') {
        iconSuccess!.classList.remove('hidden');
        popupTitle!.innerText = 'Â¡Message sent successfully!';
        popupMessage!.innerText =
          'Thank you for contacting Memoria Studio. We will get back to you shortly.';
      } else {
        iconError!.classList.remove('hidden');
        popupTitle!.innerText = 'Message could not be sent';
        popupMessage!.innerText =
          errorMessage || 'An unexpected error occurred. Please try again later.';
      }

      popup!.classList.remove('opacity-0', 'pointer-events-none');
      popupContent!.classList.remove('scale-90');
      popupContent!.classList.add('scale-100');

      setTimeout(() => {
        popup!.classList.add('opacity-0', 'pointer-events-none');
        popupContent!.classList.remove('scale-100');
        popupContent!.classList.add('scale-90');
      }, 5000);
    }

    function showError(input: HTMLElement, errorMsg: HTMLElement | null) {
      if (input) {
        input.classList.add('border-red-500', 'ring-red-500', 'focus:ring-red-500');
      }
      if (errorMsg) {
        errorMsg.classList.remove('hidden');
      }
    }

    function resetErrors() {
      [firstNameInput, lastNameInput, emailInput, subjectInput, messageInput].forEach((input) => {
        if (input) {
          input.classList.remove('border-red-500', 'ring-red-500', 'focus:ring-red-500');
        }
      });

      [errorFirstName, errorLastName, errorEmail, errorSubject, errorMessage].forEach((msg) => {
        if (msg) {
          msg.classList.add('hidden');
        }
      });
    }
  }

  const updateAutofillStyles = () => {
    const isDark = document.documentElement.classList.contains('dark');
    const styleId = 'autofill-dynamic-style';
    let styleTag = document.getElementById(styleId);

    if (!styleTag) {
      styleTag = document.createElement('style');
      styleTag.id = styleId;
      document.head.appendChild(styleTag);
    }

    const textColor = isDark ? '#ffffff' : '#000000';

    styleTag.textContent = `
      input:-webkit-autofill,
      input:-webkit-autofill:hover,
      input:-webkit-autofill:focus,
      textarea:-webkit-autofill,
      textarea:-webkit-autofill:hover,
      textarea:-webkit-autofill:focus,
      select:-webkit-autofill {
        -webkit-box-shadow: 0 0 0px 1000px transparent inset !important;
        -webkit-text-fill-color: ${textColor} !important;
        transition: background-color 9999s ease-in-out 0s;
      }
    `;
  };

  updateAutofillStyles();

  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        updateAutofillStyles();
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });
</script>
